"use strict";!function(e){let t=null,n=null,a=null,l=null,o=0,r=e=>document.getElementById(e),i=(e,t=!1)=>{t&&e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1},d=e=>{let t=r(e);t.close?t.close():jQuery("#"+e).modal("hide")},s=e=>{"string"==typeof e&&(e=r(e)),e.open?e.open():jQuery(e).modal("show")},m=e=>{let t=new FormData;return Object.keys(e).forEach(n=>{"object"!=typeof e[n]?t.append(n,e[n]):t.append(n,JSON.stringify(e[n]))}),t},c=(t,n={},a=()=>{},l=!1)=>{"object"==typeof n?n instanceof FormData||(n=m(n)):"string"==typeof n&&(n=new URLSearchParams(n)),t&&n.set("task",t),fetch(e.V.aBaseURL,{method:"POST",body:n}).then(e=>{if(!e.ok)throw Error(`HTTP ${e.status}`);return l?e.json():e.text()}).then(e=>a(e)).catch(e=>alert("Failure: "+e))};e.newFolder=(e,t)=>{i(e);let n=document.forms.un_newfold;return document.formvalidator.isValid(n)&&c("EditRaw.saveFolder",new FormData(n),e=>{if(d("foldercr-modal"),e){alert(e);return}window.location.reload(!0)}),!1},e.saveFolder=(e,t)=>{i(e);let n=document.forms.un_edtfold;return document.formvalidator.isValid(n)&&c("EditRaw.saveFolder",new FormData(n),e=>{if(d("foldered-modal"),e){alert(e);return}window.location.reload(!0)}),!1},e.performSearch=t=>""!==t.sterm.value.trim()||(alert(e.L.no_sterm),!1),e.deleteItem=e=>{let t=document.forms.actForm;return t.task.value="Edit.deleteItem",t.submit(),!1},e.aj_delAttach=(t,n,a)=>{i(t),confirm(e.L.sure_del_att)&&c("EditRaw.detach",{contentID:n,file:a},e=>{e.err?alert(e.err):r("attachments").innerHTML=e.htm},!0)},e.aj_renAttach=(t,n,a)=>{i(t);let l=prompt(e.L.rename_att,a);l&&c("EditRaw.renAttach",{contentID:n,file:a,tofile:l},e=>{e.err?alert(e.err):r("attachments").innerHTML=e.htm},!0)},e.sprintf=(e,...t)=>{for(let n=0;n<t.length;n++)e=e.replace(/%s/,t[n]);return e},e.fup_done=t=>{t||(r("filupld").style.display="none"),c("EditRaw.attlist",{contentID:e.V.contentID,inedit:1},e=>{e?r("attachments").innerHTML=e:alert("no data")})},e.getAttach=(t,n,a)=>{i(t,!0);let l=n.parentElement.dataset.afile,o=e.V.aBaseURL+"&view=atvue&cat="+e.V.itemID+"|"+e.V.contentID+"|"+l;a?r("dnldf").src=o+"&down=1":window.open(o,"_blank")},e.moveTo=n=>(i(n),(t=document.createElement("div")).className="utildlog",a.appendChild(t),c("EditRaw.cat_hier",{iID:e.V.itemID,pID:e.V.parentID},e=>{e?t.innerHTML=e:alert("no data")}),!1),e.addAttach=t=>{i(t),e.Upld5d.Init(),r("filupld").style.display="block"},e.doMove=n=>{n&&c("EditRaw.movitm",{iID:e.V.itemID,pID:r("moveTo").value},e=>{e?alert(e):window.location.reload()}),a.removeChild(t),t=null},e.addRating=(t,n)=>{c("Raw.addRating",{rate:t,iID:e.V.itemID},n,!0)},e.toolAct=(t,n)=>{h(),(!t.target.dataset.sure||confirm(e.sprintf(e.L.ru_sure,t.target.dataset.sure)))&&(i(t),c("EditRaw.tool",{mnuact:n,iID:e.V.itemID,cID:e.V.contentID},e=>{e?alert(e):window.location.reload()}))},e.toolMenu=e=>{i(e),f("putmenu",e.pageX-60,e.pageY-4)},e.dnldAttach=(t,n)=>{i(t);let a=e.V.aBaseURL+"adnld/"+e.V.contentID+"/"+n.rel,l=document.createElement("iframe");l.src=a,l.style.display="none",document.body.appendChild(l)},e.printNote=(e,t)=>{i(e,!0),window.open(t.href)},e.submitComment=e=>{e.disabled=!0;let t=new FormData(newcmnt);t.append("nid",o),c(null,t,t=>{d("comment-modal"),e.disabled=!1,l.innerHTML=t.htm},!0)},e.deleteComment=(e,t)=>{i(e);let n=new FormData;n.append("task","Raw.delComment"),n.append("cmntid",t),n.append(Joomla.getOptions("csrf.token"),1),c(null,n,t=>{let n=e.target.parentElement.parentElement;n.parentElement.removeChild(n),t.htm&&(l.innerHTML=t.htm)},!0)},e.fetchComments=e=>{e.disabled=!0;let t=new FormData;t.append("task","Raw.getComments"),t.append("nid",o),c(null,t,t=>{document.querySelector("#comments-modal .comments").innerHTML=t.htm;let n=r("comments-modal");s(n),e.disabled=!1},!0)},e.cmntNote=(t,n)=>{if(i(t,!0),o=e.V.itemID,l=n,n.children[0].classList.contains("hasem"))e.fetchComments(l);else{r("cmnt-text").value="";let a=r("comment-modal");s(a)}};let p=null,u=0,f=(t,n,a,l=3500)=>{e.mcancelclosetime(),u&&(u.style.display="none"),(u=r(t)).style.display="block",e.mclosetime(l)};e.qView=t=>{let n=t.parentElement.dataset.href,a=r("qview-modal"),l=a.querySelector(".modal-title");l.innerHTML='<a href="'+n+'">'+t.innerHTML+"</a>",r("qviewdata").innerHTML="Loading...",a.open?a.open():jQuery(a).modal("show");let o=new URLSearchParams("qview=1"),i=null;fetch(n+"&format=raw",{method:"POST",body:o}).then(e=>{if(!e.ok)throw Error(`HTTP ${e.status}`);return i=e.headers.get("Has-Att"),e.text()}).then(t=>{i&&(l.innerHTML+=" "+e.I.clip),r("qviewdata").innerHTML=t}).catch(e=>alert("Failure: "+e))},e.link2=e=>{let t=void 0===e.parentElement.dataset.href?e.dataset.href:e.parentElement.dataset.href;window.location.href=t};let h=()=>{u&&(u.style.display="none")};e.mclosetime=e=>{p=window.setTimeout(h,e)},e.mcancelclosetime=()=>{p&&(window.clearTimeout(p),p=null)},e.watchcmnt=()=>{let e=r("cmntSbb");document.forms.newcmnt.name.value.trim()&&document.forms.newcmnt.cmntext.value.trim()?e.disabled=!1:e.disabled=!0};let w=e=>{"fa fa-info-circle"!=e.target.className&&(n.close(),document.body.removeChild(n),n=null)};e.helpDisplay=e=>{c("Raw.help",{wht:e},e=>{(n=document.createElement("dialog")).setAttribute("class","rj_hdlog"),n.innerHTML=e,document.body.appendChild(n),window.addEventListener("click",w),window.addEventListener("keydown",w),n.show()})};let v=t=>{let n=t.target;if(n.classList.contains("sure")){if(t.stopPropagation(),t.preventDefault(),!confirm(e.sprintf(e.L.ru_sure,n.dataset.suremsg)))return!1;window.location.href=n.href}};document.addEventListener("DOMContentLoaded",()=>{(a=r("container"))&&a.addEventListener("click",v);let e=r("foldercr-modal");e&&e.addEventListener("shown.bs.modal",()=>r("jform_title").focus()),(e=r("comment-modal"))&&e.addEventListener("shown.bs.modal",()=>r("cmnt-text").focus())})}(window.UNote=window.UNote||{}),"undefined"!=typeof Joomla&&(Joomla.submitbutton=function(e){if("cancel"==e.split(".")[1])return!0;Joomla.submitform(e)});