'use strict';UNote.Upld5d=function(){function A(b,a){let c=this;c.show=e=>{c.pb.style.width=100*e+"%";1===e&&(c.pb.className="indeterm")};c.msg=(e,f)=>{c.pbi.innerHTML+="<br />"+e;f&&(c.pbi.className="pbfinf failure",h++)};c.rmov=()=>{c.pbw._ufo=null;k.removeChild(c.pbw);c.fObj=null};let d=l("div","",{class:"pbwrp"});c.pb=d.appendChild(l("div","",{class:a}));c.pbi=d.appendChild(l("div",b.fn+'<i class="fa fa-window-close abortX" aria-hidden="true" onclick="this.parentNode.parentNode._ufo.doAbort(true);"></i>',
{class:"pbfinf"}));k.appendChild(d);c.pbw=d;c.pbw._ufo=b;c.fObj=b;return c}function B(b){let a=this;var c=null;a.fn=b.fileName||b.name;a.lastsz=0;a.fsize=b.size;a.doAbort=function(){a.xhr?a.xhr.abort():a.progress.rmov()};a.xhr=new XMLHttpRequest;if(a.xhr.upload)if(a.xhr._fName=b.name,a.xhr.upload.onabort=function(e){m(a.fsize-a.lastsz)},a.xhr.upload.onloadstart=function(e){a.xhr.upload.onprogress=function(f){f.lengthComputable&&(a.progress.show(f.loaded/f.total),m(f.loaded-a.lastsz),a.lastsz=f.loaded)}},
"object"==typeof fup_ftypes&&0>fup_ftypes.indexOf(b.type)?c=UNote.sprintf(UNote.L.fbadtyp,b.type):b.size>uploadMaxFilesize&&(c=UNote.L.fsz2big),a.progress=new A(a,"normpb"),c)a.progress.msg(c,!0),m(b.size),a.xhr=null,n(!0,"errM");else if(a.xhr.onreadystatechange=function(e){4==a.xhr.readyState&&(200==a.xhr.status?(a.progress.rmov(),p+=a.xhr.responseText):(a.progress.msg(0==a.xhr.status?"-- aborted":a.xhr.status+": "+(a.xhr.statusText||a.xhr.responseText),!0),console.log(a.xhr)),a.xhr=null,n(!0,"rst"))},
a.xhr.open("POST",upldDestURL,!0),fup_payload){c=new FormData;c.append(x,b);for(var d in fup_payload)c.append(d,fup_payload[d]);a.xhr.send(c)}else a.xhr.setRequestHeader("Content-Type","application/octet-stream"),a.xhr.setRequestHeader("X_FILENAME",b.name),a.xhr.send(b)}var y=!1,q,k,r=[],t=0,h=0,u=0,v=0,p="",x="user_file[]";const g=b=>document.getElementById(b),l=(b,a,c)=>{b=document.createElement(b);a&&(b.innerHTML=a);for(let d in c)b.setAttribute(d,c[d]);return b},w=b=>{b.stopPropagation();b.preventDefault();
b.target.className="dragover"==b.type?"hover":""},z=b=>{w(b);b=b.target.files||b.dataTransfer.files;for(var a=0,c;c=b[a];a++)u+=c.size,r.push(c),n(!1,"fsel")},n=(b,a)=>{b&&!--t&&(typeof("function"==UNote.fup_done)&&UNote.fup_done(h),u=v=h=0,p&&console.log(p));r.length&&3>t&&(new B(r.shift()),t++)},m=b=>{q&&(v+=b,q.style.width=100*v/u+"%")};return{Init:()=>{if(!y){var b=g("upload_field"),a=g("dropArea"),c=g("submitbutton");b&&(b.addEventListener("change",z,!1),x=b.name);(new XMLHttpRequest).upload&&
(a.addEventListener("dragover",w,!1),a.addEventListener("dragleave",w,!1),a.addEventListener("drop",z,!1),a.style.display="block",c&&(c.style.display="none"),q=g("totprogress"),k=g("fprogress"));y=!0}}}}();